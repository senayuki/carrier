porting from XrayR project
https://github.com/XrayR-project/XrayR/tree/master/common